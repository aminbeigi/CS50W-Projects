{% extends "auctions/layout.html" %}
{% load crispy_forms_tags %}

{% block body %}
    <h2>Listing: {{ listing.title }}</h2>


    <div class="container">
        <img src="{{ listing.image.url }}" alt="image">
        <div>
            <h4>Description</h4>
            <p>{{ listing.description }}</p>
        </div>
        <hr>

		<div>
        {% if listing.bids.all.count == 0 %}
			Active price: <h3>${{ listing.price }}</h3>
		{% else %}
            Active price: <h3>${{ listing.bids.all.last.price }}</h3>
        {% endif %}
		Listing price: <h3>${{ listing.price }}</h3>
		</div>

        {% if listing.bids.all.count == 0 %}
            <p>Highest Bidder: No one has bidded yet, be the first!</p>
        {% else %}
            <p>Highest Bidder: {{ listing.bids.all.last.author.username }}</p>
        {% endif %}
        <p>{{ listing.bids.all.count }} bid(s) so far.</p> 

		<div class ="content-section">
			<form method="post">
				{% csrf_token %}
				<fieldset class="form-group">
					{{ bid_form|crispy }}
				</fieldset>
				<div class="form-group">
					<button class="btn btn-outline-info" type="submit" name="bid-form">Place Bid</button>
				</div>
			</form>
        </div>

        <hr>
        <h3>Details</h3>
        <ul>
            <li>Listed by: {{ listing.author }}</li>
            <li>Created {{ listing.date_posted|date:"M j, Y, fa" }}</li>
		</ul>

		<hr>
		<h3>Comments</h3>
		<div>
			{% for comment in listing.comments.all %}
					<div class="card">
						<div class="media">
							<img class="mr-3" src="/media/default_profile_image.png" alt="profile image" width="128px">
						
							<div class="media-body">
								
								<p><b>{{ comment.author.username }}</b> {{ comment.date_posted|date:"d/m/y" }}</p>
								<p>{{ comment.comment }}</p>
							</div>

						</div>
					</div>
			    {% empty %}
					<p>No comments have been posted yet.</p>
			{% endfor %}
		</div>
		<div class ="content-section">
			<form method="post">
				{% csrf_token %}
				<fieldset class="form-group">
					<legend class="border-bottom mb-4">Create a comment:</legend>
					{{ comment_form|crispy }}
				</fieldset>
				<div class="form-group">
					<button class="btn btn-outline-info" type="submit" name="comment-form">Submit</button>
				</div>
			</form>
		</div>

    <div>
{% endblock %}